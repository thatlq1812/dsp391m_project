project:
  name: traffic-forecast-node-radius
  version: v2.0
  timezone: Asia/Ho_Chi_Minh
  bbox: [10.67, 106.60, 10.90, 106.84] # HCMC Ben Thanh marke

# Global runtime parameters (used by collectors and runners)
globals:
  # Default area used when collector-specific area is not provided
  area:
    mode: point_radius
    center: [106.697794, 10.772465]
    radius_m: 3000
  # Base directory to store run outputs (each run will create a timestamped subfolder)
  output_base: data_runs

data:
  parquet_dir: ./data/parquet
  json_dir: ./data
  cache_dir: ./cache

collectors:
  overpass:
    enabled: true
    url: https://overpass-api.de/api/interpreter
    query_timeout: 120
    output: data/nodes.json
    # Area selection: supports mode = bbox | point_radius
    # bbox format: [min_lat, min_lon, max_lat, max_lon] (matches Overpass south,west,north,east)
    area:
      # mode: bbox
      mode: point_radius
      # bbox: [10.67, 106.60, 10.90, 106.84]
      center: [106.697794, 10.772465] # lon, lat (only for point_radius)
      radius_m: 3000

  open_meteo:
    enabled: true
    base_url: https://api.open-meteo.com/v1/forecast
    grid_size: 0.05
    current_params: [temperature_2m, precipitation, wind_speed_10m]
    forecast_params: [temperature_2m, precipitation, wind_speed_10m]
    horizons_min: [5, 15, 30, 60]
    output_current: data/weather_snapshot.json
    output_forecast: data/weather_forecast.json
    # Area selection for Open-Meteo collector
    area:
      mode: bbox # or point_radius
      # bbox: [10.67, 106.60, 10.90, 106.84]
      center: [106.697794, 10.772465] # lon, lat (only for point_radius)
      radius_m: 3000

  google_directions:
    enabled: true
    api_key_env: GOOGLE_MAPS_API_KEY
    k_neighbors: 3
    radius_km: 0.8
    output: data/traffic_edges.json
    # Area selection for Google Directions collector (used to filter nodes before kNN)
    area:
      # mode: bbox
      # bbox: [10.67, 106.60, 10.90, 106.84]
      mode: point_radius
      center: [106.697794, 10.772465] # lon, lat (only for point_radius)
      radius_m: 3000

pipelines:
  normalize:
    resample_minutes: 10
    output: data/traffic_snapshot_normalized.json

  enrich:
    geocode_fallback: nominatim
    impact_radius_km: 2.0
    output_events: data/events_enriched.json
    output_impacts: data/event_impacts.json

  features:
    schema: configs/nodes_schema_v2.json
    output: data/features_nodes_v2.json

  model:
    type: linear_regression # or lstm
    test_size: 0.2
    random_state: 42
    output_model: models/linear_v2.pkl
    predictions_file: data/predictions.json
    infer_limit: 1000
    # For LSTM:
    # seq_length: 5
    # epochs: 10
    # batch_size: 32

scheduler:
  interval_minutes: 10
  jobs:
    - overpass
    - open_meteo_current
    - open_meteo_forecast
    - google_directions
    - normalize
    - enrich
    - build_features
    - infer_batch

api:
  title: Traffic Forecast API
  description: API for traffic speed predictions
  host: 0.0.0.0
  port: 8000
  predictions_file: data/predictions.json

visualize:
  nodes_map:
    figsize: [10, 8]
    s: 1
    alpha: 0.5
    color: blue
    label: Nodes
    title: Traffic Nodes in HCMC
    xlabel: Longitude
    ylabel: Latitude
    save_path: data/nodes_map.png
    limit_nodes: 10000

  traffic_heatmap:
    figsize: [10, 8]
    s: 5
    alpha: 0.7
    cmap: RdYlGn_r
    title: Traffic Speed Heatmap
    xlabel: Longitude
    ylabel: Latitude
    save_path: data/traffic_heatmap.png

  events_map:
    figsize: [10, 8]
    node_s: 1
    node_alpha: 0.3
    node_color: blue
    event_s: 100
    event_color: red
    event_marker: x
    title: Events and Nodes
    xlabel: Longitude
    ylabel: Latitude
    save_path: data/events_map.png
