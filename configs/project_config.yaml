# Optimized Traffic Forecasting Configuration v3.0
project:
  name: traffic-forecast-optimized
  version: v3.0
  timezone: Asia/Ho_Chi_Minh
  bbox: [10.67, 106.60, 10.90, 106.84]

globals:
  area:
    mode: point_radius
    center: [106.697794, 10.772465] # Central HCMC
    radius_m: 512 # Increased coverage
  node_spacing_m: 500 # Optimized spacing
  output_base: data_runs

data:
  parquet_dir: ./data/parquet
  json_dir: ./data
  cache_dir: ./cache

collectors:
  overpass:
    enabled: true
    url: https://overpass-api.de/api/interpreter
    query_timeout: 60 # Reduced
    cache_expiry_hours: 168 # 1 week
    area:
      mode: point_radius
      center: [106.697794, 10.772465]
      radius_m: 512

  open_meteo:
    enabled: true
    base_url: https://api.open-meteo.com/v1/forecast
    current_params: [temperature_2m, precipitation, wind_speed_10m]
    forecast_params: [temperature_2m, precipitation, wind_speed_10m]
    horizons_min: [5, 15, 30, 60] # Reduced horizons
    cache_expiry_hours: 1
    area:
      mode: point_radius
      center: [106.697794, 10.772465]
      radius_m: 512

  google_directions:
    enabled: true
    api_key_env: GOOGLE_MAPS_API_KEY
    base_speed_kmh: 30
    traffic_factor_min: 0.5
    traffic_factor_max: 1.5
    rate_limit_requests_per_minute: 2800
    area:
      mode: point_radius
      center: [106.697794, 10.772465]
      radius_m: 512

api:
  title: Traffic Forecast API
  description: API serving node-level traffic forecasts
  predictions_file: data/predictions.json
  port: 8000

pipelines:
  preprocess:
    features_file: data/features_nodes_v2.json
    output_dir: data/processed
    target_column: avg_speed_kmh
    feature_columns:
      - temperature_c
      - rain_mm
      - wind_speed_kmh
      - forecast_temp_t5_c
      - forecast_temp_t15_c
      - forecast_temp_t30_c
      - forecast_temp_t60_c
      - forecast_rain_t5_mm
      - forecast_rain_t15_mm
      - forecast_rain_t30_mm
      - forecast_rain_t60_mm
      - forecast_wind_t5_kmh
      - forecast_wind_t15_kmh
      - forecast_wind_t30_kmh
      - forecast_wind_t60_kmh
    keep_columns:
      - node_id
      - ts
    drop_na_threshold: 0.0
    test_size: 0.2
    random_state: 42
    scaler_path: models/feature_scaler.pkl
    metadata_path: data/processed/metadata.json
  model:
    type: linear_regression
    test_size: 0.2
    random_state: 42
    output_model: models/linear_v2.pkl
    predictions_file: data/predictions.json
    infer_limit: 1000
    target_column: avg_speed_kmh
    metadata_path: models/model_metadata.json
