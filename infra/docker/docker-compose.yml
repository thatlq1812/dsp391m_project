version: '3.8'

services:
 postgres:
 image: postgres:15
 environment:
 POSTGRES_DB: traffic
 POSTGRES_USER: user
 POSTGRES_PASSWORD: pass
 ports:
 - "5432:5432"
 volumes:
 - postgres_data:/var/lib/postgresql/data

 redis:
 image: redis:7-alpine
 ports:
 - "6379:6379"

 api:
 build: .
 ports:
 - "8000:8000"
 environment:
 - DATABASE_URL=postgresql://user:pass@postgres:5432/traffic
 - REDIS_URL=redis://redis:6379/0
 depends_on:
 - postgres
 - redis

volumes:
 postgres_data: